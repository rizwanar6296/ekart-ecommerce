<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js"></script>
<div class="card">
    <div class="card-body">
        <h1 class="card-title text-center" style="font-size: 35px ;">Sales Report </h1>
        <!-- Bordered Tabs Justified -->
        <ul class="nav nav-tabs nav-tabs-bordered d-flex" id="borderedTabJustified" role="tablist">
            <li class="nav-item flex-fill" role="presentation">
                <button class="nav-link w-100 active" id="home-tab" data-bs-toggle="tab"
                    data-bs-target="#bordered-justified-home" type="button" role="tab" aria-controls="home"
                    aria-selected="true">Weekly</button>
            </li>
            <li class="nav-item flex-fill" role="presentation">
                <button class="nav-link w-100" id="profile-tab" data-bs-toggle="tab"
                    data-bs-target="#bordered-justified-profile" type="button" role="tab" aria-controls="profile"
                    aria-selected="false">Monthly</button>
            </li>
            <li class="nav-item flex-fill" role="presentation">
                <button class="nav-link w-100" id="contact-tab" data-bs-toggle="tab"
                    data-bs-target="#bordered-justified-contact" type="button" role="tab" aria-controls="contact"
                    aria-selected="false">Yearly</button>
            </li>
        </ul>
        <div class="tab-content pt-2" id="borderedTabJustifiedContent">
            <div class="tab-pane fade show active" id="bordered-justified-home" role="tabpanel"
                aria-labelledby="home-tab">
                <div class="container">
                    <div class="card">
                        <div class="card-body">


                            <div class="table-responsive mt-2">
                                <div class="table-wrapper">
                                      <a class="btn btn-outline-success" onclick="dailyData()" href="#">
                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-download me-1"
                                            fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd"
                                                d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                                            <path fill-rule="evenodd"
                                                d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
                                        </svg>
                                        Download Excel
                                    </a>
                                    <button type="button" class="btn btn-outline-success"
                                        onclick="downloadReport('daily-sales-report')"> <i class="bi bi-download"></i>  Download PDF</button>
                                    <table id="daily-sales-report" class="table">
                                        <thead>
                                            <tr class="col-12 text-center">
                                                <th>No</th>
                                                <th>Date</th>
                                                <th>Total Amount</th>
                                                <th>Total Orders</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {{#each weeklySalesReport}}
                                            <tr class="text-center">
                                                <td>{{indexing @index}}</td>
                                                <td>{{this._id}}</td>
                                                <td>{{this.totalSaleAmount}}</td>
                                                <td>{{this.count}}</td>
                                            </tr>
                                            {{/each}}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="bordered-justified-profile" role="tabpanel" aria-labelledby="profile-tab">

                <div class="container">
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive mt-2">
                                <div class="table-wrapper">
                                    <a class="btn btn-outline-success" onclick="monthlyData()" href="#">
                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-download me-1"
                                            fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd"
                                                d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                                            <path fill-rule="evenodd"
                                                d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
                                        </svg>
                                        Download Excel
                                    </a>
                                    <button type="button" class="btn btn-outline-success"
                                        onclick="downloadReport('monthly-sales-Report')"> <i class="bi bi-download"></i> Download PDF</button>
                                    <table id="monthly-sales-Report" class="table">
                                        <thead>
                                            <tr class="col-12 text-center">
                                                <th>No</th>
                                                <th>Date</th>
                                                <th>Total Amount</th>
                                                <th>Total Orders</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {{#each monthlySalesReport}}
                                            <tr class="text-center">
                                                <td>{{indexing @index}}</td>
                                                <td>{{this._id}}</td>
                                                <td>{{this.totalSaleAmount}}</td>
                                                <td>{{this.count}}</td>
                                            </tr>
                                            {{/each}}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="bordered-justified-contact" role="tabpanel" aria-labelledby="contact-tab">
                <div class="container">
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive mt-2">
                                <div class="table-wrapper">
                                    <a class="btn btn-outline-success" onclick="yearlyData()" href="#">
                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-download me-1"
                                            fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd"
                                                d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                                            <path fill-rule="evenodd"
                                                d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
                                        </svg>
                                        Download Excel
                                    </a>
                                    <button type="button" class="btn btn-outline-success"
                                        onclick="downloadReport('yearly-sales-Report')"><i class="bi bi-download"></i> Download PDF</button>
                                    <table id="yearly-sales-Report" class="table">
                                        <thead>
                                            <tr class="col-12 text-center">
                                                <th>No</th>
                                                <th>Date</th>
                                                <th>Total Amount</th>
                                                <th>Total Orders</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {{#each yearlySalesReport}}
                                            <tr class="text-center">
                                                <td>{{indexing @index}}</td>
                                                <td>{{this._id}}</td>
                                                <td>{{this.totalSaleAmount}}</td>
                                                <td>{{this.count}}</td>
                                            </tr>
                                            {{/each}}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- End Bordered Tabs Justified -->

    </div>
</div>


<script type="text/javascript">
    function downloadReport(reportId) {
        console.log(reportId)
        var doc = new jsPDF('p', 'pt', 'letter');
        var htmlstring = '';
        var tempVarToCheckPageHeight = 0;
        var pageHeight = 0;
        pageHeight = doc.internal.pageSize.height;
        specialElementHandlers = {
            // element with id of "bypass" - jQuery style selector  
            '#bypassme': function (element, renderer) {
                // true = "handled elsewhere, bypass text extraction"  
                return true
            }
        };
        margins = {
            top: 150,
            bottom: 60,
            left: 40,
            right: 40,
            width: 600
        };
        var y = 20;
        doc.setLineWidth(2);
        doc.text(200, y = y + 30, (reportId == 'daily-sales-report') ? 'Daily Sales Report' : (reportId == 'monthly-sales-Report') ? 'Monthly Sales Report' : 'Yearly Sales Report');
        doc.autoTable({
            html: '#' + reportId,
            startY: 70,
            theme: 'grid',
            columnStyles: {
                0: {
                    cellWidth: 180,
                },
                1: {
                    cellWidth: 80,
                },
                2: {
                    cellWidth: 80,
                },
                            {{!-- 3: {
            cellWidth: 80,
        } --}}
                        },
    styles: {
        minCellHeight: 40
    }
                    })

    doc.save((reportId + '.pdf'));
                }
</script>   





<script>
                function dailyData() {
                    const data = `
     date, Total, count
    {{#each weeklySalesReport}}
    {{_id}},{{totalSaleAmount}},{{count}}
    {{/each}}`

                    const blob = new Blob([data], { type: 'octet-stream' })

                    const href = URL.createObjectURL(blob)

                    const a = Object.assign(document.createElement('a'), {
                        href,
                        style: 'display:none',
                        download: 'data.csv'
                    })

                    document.body.appendChild(a)

                    a.click()

                    URL.revokeObjectURL(href)

                    a.remove()
                }

                function monthlyData() {
                    const data = `
     date, Total,Total Orders,
    {{#each monthlySalesReport}}
    {{_id}},{{totalSaleAmount}},{{count}}
    {{/each}}`

                    const blob = new Blob([data], { type: 'octet-stream' })

                    const href = URL.createObjectURL(blob)

                    const a = Object.assign(document.createElement('a'), {
                        href,
                        style: 'display:none',
                        download: 'data.csv'
                    })

                    document.body.appendChild(a)

                    a.click()

                    URL.revokeObjectURL(href)

                    a.remove()
                }

                function yearlyData() {
                    const data = `
    date, Total,Total Orders,
    {{#each yearlySalesReport}}
    {{_id}},{{totalSaleAmount}},{{count}}
    {{/each}}`

                    const blob = new Blob([data], { type: 'octet-stream' })

                    const href = URL.createObjectURL(blob)

                    const a = Object.assign(document.createElement('a'), {
                        href,
                        style: 'display:none',
                        download: 'data.csv'
                    })

                    document.body.appendChild(a)

                    a.click()

                    URL.revokeObjectURL(href)

                    a.remove()
                }
            </script>